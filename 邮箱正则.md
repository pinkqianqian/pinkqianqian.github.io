# 邮箱正则

## 邮箱规则：
> 举例163的（VIP邮箱格式）：以字母开头的字母（但也有数字开头的，所以我放开了）、数字、下划线、点、连字符组合@163.com
经多次实验，隐形的校验是“@”符号前只能是字母或数字结尾，不能是连字符、点和下划线。
其他知乎、掘金、qq的邮箱也做了实验，验证都放得很开，所以此次邮箱正则就以163的校验为准。

## 列举邮箱格式：

* `xqq.mina-test_1@163.com.cn`
* `xqq@163.com`

对比以上两个格式，不同部分，即为可有可无。

## 分段分析：

1. 开始部分
  * 以字母（包含大小写）、数字开头
  * 正则：^  	表示以谁开始
  * [a-zA-Z0-9]  字符组 表示其中任意一个，但可能有1个或多个（+表示），所以最终是：^[a-zA-Z0-9]+
2. 中间部分:
  * 有字母、数字、下划线、点、连字符组合，格式一般就是.XXX.XXX.XXX，以点开头的字符任意组合
  * 正则：[\.]  表示点
  * [a-zA-Z0-9_-]+ 表示任意字符组合，有一或多个
  * [\.][a-zA-Z0-9_-]+  表示一组“.XXX”，但可能有多组所以，仍然用“+”表示，所以变成了 ([\.][a-zA-Z0-9_-]+)+
  * 又因为“@”前面一位不能是点、下划线、连字符，只能是数字或字母，所以我又添了一组不带点、下划线、连字符的字符组[a-zA-Z0-9]，
这样中间部分就成了([\.][a-zA-Z0-9_-]+)+[a-zA-Z0-9]，但因为这部分是出现0次或多次的格式，所以(([\.][a-zA-Z0-9_-]+)+[a-zA-Z0-9])*
3. @连接部分（@XXXXX）:
这部分没有太多的参考格式，暂且就定为字母、数字、下划线、连字符随机组合
那就是[a-zA-Z0-9_-]+，表示该字符组任意字符一次或多次组合
4. 结尾域名部分有两种，举例.com（固定为3个字符），和.com.cn，.cn部分是可有可无的（固定为两个字符），
所以，[a-zA-Z]{3}，表示任意大小写字母总共匹配三个字符，[a-zA-Z]{2}就是匹配两个字符了，加上点[\.]，
组合起来就是 ([\.][a-zA-Z]{3})([a-zA-Z]{2})?，?表示出现0次或1次。

以上四部分链接起来就是，`^[a-zA-Z0-9]+(([\.][a-zA-Z0-9_-]+)+[a-zA-Z0-9])*@[a-zA-Z0-9_-]+([\.][a-zA-Z]{3})([a-zA-Z]{2})?$`

## 优化

简化一波
  * \w表示大小写字母、数字、下划线，即[a-zA-Z0-9_]
  * \d 表示数字，即[0-9]
  * i  表示不分大小写字母
  
所以优化后，如下：

> /^[a-z\d]+(([\.][\w-]+)+[a-z\d])*@[\w-]+([\.][a-z]{3})([\.][a-z]{2})?$/i

